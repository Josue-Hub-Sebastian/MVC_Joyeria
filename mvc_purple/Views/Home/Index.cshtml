@using System.Linq
@model List<mvc_purple.Models.Producto>

@{
    ViewData["Title"] = "Home Page";
}

<!-- Fondo general -->
<style>
	body {
		background-color: #f3f0f5;
	}
</style>

<!-- Banner / Encabezado -->
<div class="row mb-5">
	<div class="col-12">
		<div class="p-5 rounded shadow-sm position-relative overflow-hidden" style="background-color: #e6ddf5;">

			<!-- Ícono decorativo flotante -->
			<div class="position-absolute top-0 end-0 opacity-25 pe-4 pt-4">
				<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#9f7aea" class="bi bi-stars" viewBox="0 0 16 16">
					<path d="M7.5.25a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V1A.75.75 0 0 1 7.5.25ZM2.11 2.11a.75.75 0 0 1 1.06 0l1.06 1.06a.75.75 0 0 1-1.06 1.06L2.11 3.17a.75.75 0 0 1 0-1.06Zm11.78 0a.75.75 0 0 1 0 1.06l-1.06 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0ZM8 4.5a.5.5 0 0 1 .5.5v.805l.375.682c.324.59.493.896.593 1.208.144.441.144.919 0 1.36-.1.312-.27.618-.593 1.208l-.375.682V11a.5.5 0 0 1-1 0v-.805l-.375-.682c-.324-.59-.493-.896-.593-1.208a2.88 2.88 0 0 1 0-1.36c.1-.312.27-.618.593-1.208l.375-.682V5a.5.5 0 0 1 .5-.5Zm5.89 2.36a.75.75 0 0 1 .64.84l-.21 1.31a.75.75 0 1 1-1.48-.24l.21-1.31a.75.75 0 0 1 .84-.64Zm-11.78 0a.75.75 0 0 1 .84.64l.21 1.31a.75.75 0 0 1-1.48.24l-.21-1.31a.75.75 0 0 1 .64-.84ZM7.5 12.25a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 .75-.75Zm-4.33.42a.75.75 0 0 1 1.06 0l1.06 1.06a.75.75 0 0 1-1.06 1.06L3.17 13.73a.75.75 0 0 1 0-1.06Zm9.66 0a.75.75 0 0 1 0 1.06l-1.06 1.06a.75.75 0 0 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0Z" />
				</svg>
			</div>

			<!-- Logo + Marca -->
			<div class="d-flex align-items-center gap-2 mb-2">
				<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<circle cx="12" cy="12" r="10" stroke="#6f42c1" stroke-width="2" />
					<path d="M12 6 L14 12 L12 18 L10 12 Z" fill="#6f42c1" />
					<circle cx="12" cy="12" r="2" fill="white" />
				</svg>
				<h1 class="display-6 mb-0" style="color: #2c2c2c;">PurpleSky</h1>
			</div>

			<p class="lead" style="color: #4b4b4b;">Descubre nuestra exclusiva colección de joyas elegantes y atemporales.</p>

			@if (!User.Identity.IsAuthenticated)
			{
				<a class="btn btn-outline-dark mt-3" asp-controller="Cliente" asp-action="Registro">
					<i class="bi bi-person-plus me-1"></i> Regístrate ahora
				</a>
			}
		</div>
	</div>
</div>

<!-- Catálogo de productos -->
@if (Model?.Any() == true)
{
	<div class="row g-4">
		@foreach (var producto in Model)
		{
			<div class="col-lg-4 col-md-6">
				<div class="card border-0 shadow-sm h-100 rounded-4">
					@if (!string.IsNullOrEmpty(producto.ImagenUrl))
					{
						<img src="@producto.ImagenUrl" class="card-img-top rounded-top-4" alt="@producto.Nombre" style="height: 250px; object-fit: cover;">
					}
					else
					{
						<div class="card-img-top bg-light d-flex align-items-center justify-content-center rounded-top-4" style="height: 250px;">
							<i class="bi bi-image text-secondary fs-1"></i>
						</div>
					}

					<div class="card-body d-flex flex-column">
						<h5 class="fw-semibold text-dark">@producto.Nombre</h5>
						<p class="text-muted small flex-grow-1">@producto.Descripcion</p>

						<div class="mt-3">
							<div class="d-flex justify-content-between align-items-center mb-2">
								<span class="fw-bold" style="color: #6f42c1;">$@producto.Precio.ToString("N2")</span>
								<span class="badge border" style="background-color: #f0eaff; color: #6f42c1;">@producto.Stock unidades</span>
							</div>

							<div class="d-grid gap-2">
								<a asp-action="Detalle" asp-route-id="@producto.Id" class="btn btn-outline-secondary">
									<i class="bi bi-eye me-1"></i> Ver detalle
								</a>

								@if (User.Identity.IsAuthenticated && !User.HasClaim("EsAdmin", "True"))
								{
									@if (producto.Stock > 0)
									{
										<form asp-action="AgregarAlCarrito" method="post">
											<input type="hidden" name="productoId" value="@producto.Id" />
											<input type="hidden" name="cantidad" value="1" />
											<button type="submit" class="btn btn-primary w-100">
												<i class="bi bi-cart-plus me-1"></i> Agregar al carrito
											</button>
										</form>
									}
									else
									{
										<button class="btn btn-outline-secondary w-100" disabled>
											<i class="bi bi-x-circle me-1"></i> Sin Stock
										</button>
									}
								}
								else if (!User.Identity.IsAuthenticated)
								{
									<a asp-controller="Cliente" asp-action="Login" class="btn btn-warning w-100">
										<i class="bi bi-box-arrow-in-right me-1"></i> Inicia sesión
									</a>
								}
							</div>
						</div>
					</div>
				</div>
			</div>
		}
	</div>
}
else
{
	<div class="row">
		<div class="col-12">
			<div class="alert alert-light border text-center py-5">
				<i class="bi bi-info-circle fs-2 text-muted mb-2"></i>
				<h5 class="text-muted">No hay productos disponibles</h5>
				<p class="text-secondary">Próximamente tendremos nuevos productos para ti.</p>
			</div>
		</div>
	</div>
}
